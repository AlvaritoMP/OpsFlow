:80 {
	# Servir archivos estáticos desde el directorio dist
	root * /app/dist
	
	# IMPORTANTE: Configurar tipos MIME ANTES de file_server
	header {
		# Headers de seguridad primero
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		X-XSS-Protection "1; mode=block"
	}
	
	# Interceptar /index.tsx ANTES de file_server usando matcher específico
	@index_tsx {
		path /index.tsx
	}
	handle @index_tsx {
		rewrite * /assets/main-y7AYQDTU.js
		header Content-Type "application/javascript; charset=utf-8"
		file_server
	}
	
	# Matcher para archivos .tsx - servir como JavaScript (fallback)
	@tsx {
		file
		path *.tsx
	}
	handle @tsx {
		header Content-Type "application/javascript; charset=utf-8"
		file_server
	}
	
	# Matcher para archivos JavaScript - DEBE incluir /assets/
	@js {
		file
		path *.js
		path /assets/*.js
	}
	header @js Content-Type "application/javascript; charset=utf-8"
	
	@mjs {
		file
		path *.mjs
		path /assets/*.mjs
	}
	header @mjs Content-Type "application/javascript; charset=utf-8"
	
	# Matcher para archivos CSS
	@css {
		file
		path *.css
		path /assets/*.css
	}
	header @css Content-Type "text/css; charset=utf-8"
	
	# Matcher para archivos HTML
	@html {
		file
		path *.html
	}
	header @html Content-Type "text/html; charset=utf-8"
	
	# Servir archivos estáticos
	file_server
	
	# Para SPA: redirigir todas las rutas a index.html
	try_files {path} /index.html
	
	# Comprimir respuestas
	encode gzip zstd
}
